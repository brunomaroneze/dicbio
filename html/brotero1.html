<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compêndio de Botânica</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .page-container {
            display: flex;
            align-items: flex-start;
            margin-bottom: 40px;
        }
        .image-container img {
            max-width: 100%;
            height: auto;
            border: 1px solid #ccc;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.1);
        }
        .text-container {
            flex: 1;
            padding-left: 20px;
        }
        h2, h3 {
            color: #2c3e50;
        }
        .term {
            font-weight: bold;
            color: #16a085;
        }
    </style>
</head>
<body>

    <h1>Compêndio de Botânica</h1>
    <div id="content"></div>

    <script>
        async function loadXML() {
            const response = await fetch("https://raw.githubusercontent.com/brunomaroneze/dicbio/main/data/compendio1brotero.xml");
            const text = await response.text();
            const parser = new DOMParser();
            const xml = parser.parseFromString(text, "text/xml");

            const contentDiv = document.getElementById("content");

            let pages = xml.querySelectorAll("pb");
            let lastIndex = 0;
            let allTextNodes = Array.from(xml.querySelector("body").childNodes);

            pages.forEach((pb, index) => {
                let imgUrl = pb.getAttribute("facs");
                let pageNumber = pb.getAttribute("n");

                // Extrai o texto entre esta marca <pb> e a próxima
                let pageTextNodes = [];
                for (let i = lastIndex; i < allTextNodes.length; i++) {
                    if (allTextNodes[i] === pb) {
                        lastIndex = i + 1;
                        break;
                    }
                    if (allTextNodes[i].nodeType === 1) { // NodeType 1 = Elemento
                        pageTextNodes.push(allTextNodes[i]);
                    }
                }

                // Gera o texto formatado
                let formattedText = pageTextNodes.map(node => {
                    if (node.tagName === "p") {
                        return `<p>${formatText(node)}</p>`;
                    } else if (node.tagName === "head") {
                        return `<h3>${node.textContent}</h3>`;
                    }
                    return "";
                }).join("");

                // Cria o HTML para esta página
                let pageHTML = `
                    <div class="page-container">
                        <div class="image-container">
                            <img src="${imgUrl}" alt="Página ${pageNumber}">
                        </div>
                        <div class="text-container">
                            ${formattedText}
                        </div>
                    </div>
                `;
                contentDiv.innerHTML += pageHTML;
            });
        }

        function formatText(node) {
            return Array.from(node.childNodes).map(child => {
                if (child.nodeType === 3) { // Texto puro
                    return child.textContent;
                } else if (child.tagName === "term") {
                    return `<span class="term">${child.textContent}</span>`;
                } else if (child.tagName === "foreign") {
                    return `<i>${child.textContent}</i>`;
                }
                return child.textContent;
            }).join("");
        }

        loadXML();
    </script>

</body>
</html>
